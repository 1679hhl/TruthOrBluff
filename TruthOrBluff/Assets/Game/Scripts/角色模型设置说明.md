# 3D角色模型设置说明

## 功能概述

现在当游戏开始创建玩家时，会自动为每个玩家生成3D角色模型。系统支持：
- ✅ 自动生成角色模型
- ✅ 多个角色预制体可选
- ✅ 角色动画控制（出牌、胜利、失败等）
- ✅ 与游戏事件自动同步

---

## Unity Editor 设置步骤

### 1. 准备角色预制体

1. 导入你的3D角色模型到 Unity
2. 为角色添加 `Animator` 组件
3. 设置角色的 Animator Controller（动画控制器）
4. 可选：添加 `CharacterAnimationController` 脚本到角色上
5. 将角色保存为 Prefab

### 2. 配置 PlayerView Prefab

在你的 `PlayerView` 预制体上：

1. **设置角色生成点**
   - 在 PlayerView 下创建一个空的 GameObject，命名为 "CharacterSpawnPoint"
   - 调整其位置和旋转，这将是角色生成的位置
   - 将它拖拽到 PlayerView 组件的 `Character Spawn Point` 字段

2. **添加角色预制体**
   - 在 PlayerView 组件的 `Character Prefabs` 数组中添加你准备好的角色预制体
   - 可以添加多个不同的角色，系统会根据玩家索引自动选择
   - 例如：玩家1使用角色0，玩家2使用角色1，以此类推

### 3. 示例层级结构

```
PlayerView (Prefab)
├── Canvas
│   ├── NameText
│   ├── HandCountText
│   └── StatusIndicator
├── CharacterSpawnPoint (Transform)
│   └── [角色会在这里生成]
└── CardContainer
```

---

## 角色动画设置

### 方法1: 使用 CharacterAnimationController（推荐）

1. 将 `CharacterAnimationController` 脚本附加到你的角色预制体上
2. 在 Inspector 中设置：
   - `Animator`: 角色的 Animator 组件
   - 动画触发器名称（与你的 Animator Controller 中的参数对应）

3. 在 Animator Controller 中创建触发器：
   - `Idle` - 闲置动画
   - `PlayCard` - 出牌动画
   - `Win` - 胜利动画
   - `Lose` - 失败动画
   - `Think` - 思考动画

### 方法2: 直接使用 Animator

如果你不想使用 `CharacterAnimationController`，可以：
1. 直接通过 `PlayerView.GetCharacterModel()` 获取角色对象
2. 手动控制 Animator

---

## 代码示例

### 获取角色模型和动画控制器

```csharp
// 在 GamePresenter 或其他脚本中
var playerView = GetPlayerView(playerIndex);

// 获取角色GameObject
GameObject character = playerView.GetCharacterModel();

// 获取动画控制器
CharacterAnimationController animController = playerView.GetAnimationController();

// 播放自定义动画
if (animController != null)
{
    animController.PlayThink(); // 播放思考动画
}
```

### 自定义角色选择

```csharp
// 在创建玩家视图后，手动指定角色
view.SpawnCharacterModel(characterIndex: 2); // 使用第3个角色预制体
```

---

## 动画事件触发时机

角色动画会在以下游戏事件时自动播放：

| 游戏事件 | 触发的角色动画 |
|---------|--------------|
| 玩家出牌 | PlayCard() |
| 玩家被淘汰 | PlayLose() |
| 玩家获胜 | PlayWin() |

---

## 常见问题

### Q: 角色没有生成？
A: 检查：
1. PlayerView 的 `Character Spawn Point` 是否已设置
2. `Character Prefabs` 数组是否有预制体
3. 控制台是否有警告信息

### Q: 角色位置不对？
A: 调整 `CharacterSpawnPoint` 的 Transform（位置、旋转、缩放）

### Q: 动画没有播放？
A: 检查：
1. 角色预制体上是否有 `Animator` 组件
2. Animator Controller 是否设置正确
3. 触发器名称是否匹配

### Q: 如何让不同玩家使用不同的角色？
A: 
- 方式1: 在 `Character Prefabs` 数组中添加多个角色，系统会自动根据玩家索引分配
- 方式2: 修改 `GamePresenter.OnGameInitialized()` 方法，手动指定每个玩家的角色索引

---

## 高级定制

### 动态切换角色

```csharp
// 销毁当前角色
playerView.DestroyCharacterModel();

// 生成新角色
playerView.SpawnCharacterModel(newCharacterIndex);
```

### 角色特效

在角色预制体上添加粒子效果、光效等，它们会随角色一起生成。

### 角色交互

```csharp
GameObject character = playerView.GetCharacterModel();
if (character != null)
{
    // 添加自定义行为
    var customComponent = character.GetComponent<YourCustomComponent>();
    customComponent.DoSomething();
}
```

---

## 性能优化建议

1. **对象池**: 如果频繁创建/销毁角色，考虑使用对象池
2. **LOD**: 为远处的角色使用简化模型
3. **动画优化**: 使用 Animator Culling Mode 优化不可见角色的动画
4. **材质实例化**: 避免为每个角色创建新的材质实例

---

## 文件清单

- `PlayerView.cs` - 玩家视图，负责生成和管理角色
- `CharacterAnimationController.cs` - 角色动画控制器
- `GamePresenter.cs` - 在初始化时调用角色生成

---

**现在你可以开始创建自己的角色模型了！** 🎮
